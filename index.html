<html>
<head>
<script src="/sdk.js"></script>
<script>
    YaGames.init().then(ysdk => {
        console.log('Yandex SDK initialized');
        window.ysdk = ysdk;
    });

        YaGames.init().then(ysdk => {
        console.log('Yandex SDK initialized');
        window.ysdk = ysdk;
        
        // –ü–æ–∫–∞–∑ Sticky-–±–∞–Ω–Ω–µ—Ä–∞ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        ysdk.adv.getBannerAdvStatus().then(({ stickyAdvIsShowing, reason }) => {
            if (!stickyAdvIsShowing && !reason) {
                ysdk.adv.showBannerAdv().catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –±–∞–Ω–Ω–µ—Ä–∞:', error);
                });
            }
        });
    });
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ò–≥—Ä–∞: –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∏ –ú–∏–Ω—ã + –°—Ç–∞–≤–∫–∏</title>
  <style id="bomb-animation-style"></style>
  <style>
    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    @keyframes fadeInPage {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
      animation: fadeInPage 1s ease forwards;
      font-size: clamp(14px, 3.5vw, 16px);
      padding-bottom: 90px;
    }

    nav {
      background: #4a148c;
      padding: clamp(10px, 2vw, 15px);
      text-align: center;
      font-size: clamp(16px, 4vw, 20px);
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      animation: fadeInPage 1.2s ease forwards;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
      max-width: 90%;
      width: min(1200px, 100%);
      margin: clamp(20px, 5vw, 40px) auto;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #a855f7;
      box-shadow: 0 0 20px #a855f7;
      border-radius: 10px;
      padding: clamp(15px, 3vw, 20px);
      text-align: center;
      animation: fadeInPage 1.4s ease forwards;
    }

    .left-panel {
      flex: 1 1 400px;
      max-width: 600px;
      text-align: left;
    }

    .right-panel {
    flex: 1 1 300px;
    max-width: 500px;
    margin: 20px 0 0 20px; /* –¥–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –∏ —Å–ª–µ–≤–∞ */
    padding: 10px; /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—Å—Ç—É–ø */
    }

    h1 {
      margin: clamp(10px, 3vw, 20px) 0;
      font-size: clamp(24px, 6vw, 32px);
      text-align: center;
    }

    #game-board {
      display: grid;
      grid-template-columns: repeat(5, minmax(50px, 1fr));
      gap: clamp(5px, 1vw, 10px);
      justify-content: center;
      margin-top: 0;
      animation: fadeInPage 1.6s ease forwards;
      max-width: 100%;
      box-sizing: border-box;
    }

    .cell {
      width: 100%;
      aspect-ratio: 1 / 1; /* Maintain square cells */
      background: url('crystal-icon.png') center/contain no-repeat;
  border: 2px solid; /* –£–¥–∞–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  border-color: var(--cell-border-color, #673ab7); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é */
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s ease;
      animation: fadeInPage 1.8s ease forwards;
    }

    .cell:hover:not(.revealed) {
      transform: scale(1.05);
 box-shadow: 0 0 10px var(--hover-glow-color);
    }

    .cell.revealed {
      background: none;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: revealCellAnim 0.3s ease forwards;
    }

    @keyframes revealCellAnim {
      from {
        transform: scale(0.6);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .cell img {
      width: 60%;
      height: auto;
      animation: fadeIn 0.3s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .cell.bomb {
      animation: bombFlash 0.6s ease infinite alternate;
    }

    .cell.safe {
      background-color: transparent;
    }

    #controls {
      margin: clamp(10px, 2vw, 15px) 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: clamp(5px, 1.5vw, 10px);
      animation: fadeInPage 2s ease forwards;
    }

    #controls input, #controls select {
      padding: clamp(8px, 2vw, 12px);
      font-size: clamp(14px, 3.5vw, 16px);
      border-radius: 8px;
      border: 2px solid #673ab7;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      backdrop-filter: blur(4px);
      transition: all 0.3s ease;
      box-shadow: 0 0 10px transparent;
      flex: 1 1 clamp(120px, 30%, 200px);
      box-sizing: border-box;
    }

    #controls input::placeholder {
      color: #cccccc;
    }

    #controls input:focus, #controls select:focus {
      border-color: #a855f7;
      box-shadow: 0 0 10px #a855f7;
      outline: none;
      background-color: rgba(255, 255, 255, 0.15);
    }

    #controls select {
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: clamp(16px, 3vw, 18px);
      padding-right: clamp(20px, 5vw, 34px);
    }

    #controls select, #controls option {
      color: white;
      background-color: #1e1e2f;
    }

    #controls option {
      padding: clamp(8px, 2vw, 10px);
      font-size: clamp(14px, 3.5vw, 16px);
    }

    #controls button {
      padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
      background-color: #a855f7;
      border: none;
      color: white;
      border-radius: 5px;
      font-size: clamp(14px, 3.5vw, 16px);
      cursor: pointer;
      transition: background-color 0.3s ease;
      flex: 1 1 clamp(100px, 25%, 150px);
    }

    #controls button:hover {
      background-color: #9333ea;
    }

    #balance, #coef, #current-win {
      margin-top: clamp(8px, 2vw, 10px);
      font-size: clamp(16px, 4vw, 18px);
      animation: fadeInPage 2.2s ease forwards;
    }

    #message-box {
      position: fixed;
      top: clamp(10px, 2vw, 20px);
      right: clamp(10px, 2vw, 20px);
      max-width: min(90%, 320px);
      background-color: rgba(0, 0, 0, 0.85);
      border: 2px solid #a855f7;
      border-radius: 10px;
      padding: clamp(10px, 2vw, 15px);
      font-size: clamp(14px, 3.5vw, 18px);
      color: white;
      box-shadow: 0 0 15px #a855f7;
      display: none;
      animation: fadeInMessage 0.5s ease forwards;
      z-index: 1000;
      cursor: pointer;
    }

    #message-box.show {
      display: block;
    }

    #message-box .close-btn {
      position: absolute;
      top: clamp(1px, 1vw, 1px);
      right: clamp(1px, 1vw, 1px);
      background: transparent;
      border: none;
      color: white;
      font-size: clamp(16px, 4vw, 20px);
      cursor: pointer;
      font-weight: bold;
      line-height: 1;
      user-select: none;
    }

    @keyframes fadeInMessage {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #skin-panel {
      max-width: 90%;
      width: min(800px, 100%);
      margin: clamp(10px, 3vw, 20px) auto;
      background: rgba(0, 0, 0, 0.75);
      border: 2px solid #a855f7;
      border-radius: 10px;
      padding: clamp(15px, 3vw, 20px);
      color: white;
      box-shadow: 0 0 15px #a855f7;
      text-align: center;
    }

    .skin-item {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      margin: clamp(5px, 1.5vw, 10px);
      padding: clamp(8px, 2vw, 10px);
      border: 2px solid #673ab7;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.05);
      width: clamp(120px, 30%, 150px);
      box-sizing: border-box;
    }

    .skin-item img {
      width: clamp(48px, 15vw, 64px);
      height: auto;
      display: block;
      margin: 0 auto clamp(5px, 1vw, 10px);
    }

    .skin-item button {
      margin-top: clamp(5px, 1vw, 10px);
      padding: clamp(5px, 1.5vw, 8px) clamp(10px, 2vw, 12px);
      background-color: #a855f7;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      font-size: clamp(12px, 3vw, 14px);
    }

    /* Media Queries for Additional Responsiveness */
    @media (max-width: 600px) {
      #game-board {
        grid-template-columns: repeat(5, minmax(40px, 1fr));
        gap: 5px;
      }

      .cell {
        border-width: 1px;
      }

      #controls {
        flex-direction: column;
        align-items: center;
      }

      #controls input, #controls select, #controls button {
        width: 100%;
        max-width: 300px;
      }

      #skin-panel {
        padding: 10px;
      }

      .skin-item {
        width: 100%;
        max-width: 200px;
      }

      #message-box {
        top: 10px;
        right: 10px;
        padding: 10px;
        font-size: 14px;
      }
    }

    @media (max-width: 400px) {
      #game-board {
        grid-template-columns: repeat(5, minmax(30px, 1fr));
        gap: 3px;
      }

      h1 {
        font-size: 20px;
      }

      nav {
        font-size: 14px;
        padding: 8px;
      }

      .skin-item img {
        width: 48px;
      }
    }

.game-grid {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 84px)); /* –ú–∞–∫—Å–∏–º—É–º 84px –¥–ª—è –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–∏ */
  gap: 5px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏ */
  justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ */
  max-width: 100%; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É —Å–µ—Ç–∫–∏ */
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —è—á–µ–µ–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è */
.game-grid div {
  max-width: 84px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —è—á–µ–π–∫–∏ */
  max-height: 84px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —è—á–µ–π–∫–∏ */
  width: 100%; /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
  height: 100%; /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  background-color: #ccc; /* –ü—Ä–∏–º–µ—Ä —Ñ–æ–Ω–∞, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å—Ç–∏–ª—å */
  border: 1px solid #000; /* –ü—Ä–∏–º–µ—Ä –≥—Ä–∞–Ω–∏—Ü—ã, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Å—Ç–∏–ª—å */
  box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ–º border –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö */
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media screen and (max-width: 600px) {
  .game-grid {
    grid-template-columns: repeat(5, minmax(0, 60px)); /* –ú–µ–Ω—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
  }
  .game-grid div {
    max-width: 60px;
    max-height: 60px;
  }
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}
  </style>
</head>
<body>
  <nav>üéÆ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∏ –ú–∏–Ω—ã ‚Äî –ò–≥—Ä–∞ –Ω–∞ —É–¥–∞—á—É!</nav>
  <div class="container">
    <div class="left-panel">
      <h1>–°—Ç–∞–≤—å –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π</h1>
      <div id="balance">–ë–∞–ª–∞–Ω—Å: 100 üí∞</div>

      <div id="skin-panel">
        <h2>–í—ã–±–æ—Ä —Å–∫–∏–Ω–∞</h2>
        <div id="skins-list"></div>
      </div>

      <div id="controls">
        <input type="text" id="bet" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É" inputmode="decimal" pattern="[0-9]+([\.,][0-9]+)?" />
        <select id="mine-count">
          <option value="1">1 –º–∏–Ω–∞</option>
          <option value="3" selected>3 –º–∏–Ω—ã</option>
          <option value="5">5 –º–∏–Ω</option>
          <option value="7">7 –º–∏–Ω</option>
        </select>
        <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button onclick="collectWin()">–ó–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à</button>
        <button onclick="watchAd()">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É</button>
      </div>

      <div id="coef">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 1.00x</div>
      <div id="current-win">–¢–µ–∫—É—â–∏–π –≤—ã–∏–≥—Ä—ã—à: 0 üí∞</div>
    </div>

    <div class="right-panel">
      <div id="game-board"></div>
    </div>
  </div>

  <div id="message-box" onclick="hideMessage()">
  <button class="close-btn" onclick="event.stopPropagation(); hideMessage()">√ó</button>
  <span id="message-text"></span>
  </div>

<script type="text/javascript">
  const AD_COOLDOWN = 30000; // –£–º–µ–Ω—å—à–∞–µ–º –¥–æ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
let lastAdShown = 0;
let isAdShowing = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫–∞–∑–∞
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function InitSDK()
{
YaGames
    .init()
    .then(ysdk => {
        console.log('Yandex SDK initialized');
        window.ysdk = ysdk;
    });
}

function showFullscreenAd(context = 'default') {
    console.log(`–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∫–∞–∑–∞ —Ä–µ–∫–ª–∞–º—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ: ${context}`);
    
    if (typeof ysdk === 'undefined') {
        console.error('Yandex SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        return;
    }

    if (isAdShowing) {
        console.log('–†–µ–∫–ª–∞–º–∞ —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è');
        return;
    }

    if (Date.now() - lastAdShown < AD_COOLDOWN) {
        console.log('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø—Ä–æ—à–ª–æ–≥–æ –ø–æ–∫–∞–∑–∞');
        return;
    }

    isAdShowing = true;
    console.log('–ó–∞–ø—É—Å–∫ —Ä–µ–∫–ª–∞–º—ã...');

    ysdk.adv.showFullscreenAdv({
        callbacks: {
            onClose: (wasShown) => {
                console.log(`–†–µ–∫–ª–∞–º–∞ –∑–∞–∫—Ä—ã—Ç–∞, –ø–æ–∫–∞–∑–∞–Ω–∞: ${wasShown}`);
                isAdShowing = false;
                if (wasShown) {
                    lastAdShown = Date.now();
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–∫–∞–∑–µ
                    if (context === 'after_loss') {
                        balance += 5; // –ë–æ–Ω—É—Å –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
                        updateUI();
                    }
                }
            },
            onError: (error) => {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–∫–ª–∞–º—ã:', error);
                isAdShowing = false;
                showMessage("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–ª–∞–º—ã");
            }
        }
    });
}

        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script>

  <script>
document.getElementById('bet').addEventListener('input', function () {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
  let cursorPosition = this.selectionStart;
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–≤–æ–¥
  let newValue = this.value
    .replace(/,/g, '.') // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—ã–µ –Ω–∞ —Ç–æ—á–∫–∏
    .replace(/[^0-9.]/g, '') // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ —Ç–æ—á–µ–∫
    .replace(/\.+/g, (match, offset) => offset === 0 ? match : '.') // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Ç–æ—á–∫–∏
    .replace(/^\./, '0.') // –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –≤ –Ω–∞—á–∞–ª–µ, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–ª—å
    .replace(/(\..*)\./g, '$1'); // –£–¥–∞–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ç–æ—á–∫–∏

  // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ü–µ–ª—É—é –∏ –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç–∏
  const parts = newValue.split('.');
  if (parts.length > 1) {
    // –û–±—Ä–µ–∑–∞–µ–º –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç—å –¥–æ 2 –∑–Ω–∞–∫–æ–≤
    parts[1] = parts[1].slice(0, 2);
    newValue = parts.join('.');
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
  this.value = newValue;

  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
  const newLength = this.value.length;
  cursorPosition = Math.min(cursorPosition, newLength);
  this.setSelectionRange(cursorPosition, cursorPosition);
});

    const coefficientTable = {
      1: [1.01, 1.04, 1.09, 1.14, 1.19, 1.26, 1.33, 1.40, 1.49, 1.59, 1.71, 1.84, 1.99, 2.17, 2.39, 2.65, 2.98, 3.41, 3.98, 4.78, 5.97, 7.96, 11.94, 23.88, 23.88],
      3: [1.07, 1.23, 1.41, 1.64, 1.91, 2.25, 2.67, 3.21, 3.90, 4.80, 6.00, 7.63, 9.93, 13.24, 18.20, 26.01, 39.01, 62.42, 109.24, 218.49, 546.24, 2180.00],
      5: [1.18, 1.49, 1.91, 2.48, 3.25, 4.34, 5.89, 8.15, 11.55, 16.80, 25.21, 39.21, 63.72, 109.24, 200.29, 400.58, 901.31, 2400.00, 8410.00, 5470.00],
      7: [1.31, 1.86, 2.67, 3.92, 5.89, 9.06, 14.34, 23.48, 39.90, 70.95, 133.06, 266.12, 576.59, 1380.00, 3800.00, 12680.00, 57008.00, 456660.00]
    };

    let boardSize = 5;
    let totalCells = boardSize * boardSize;
    let cells = [];
    let bombs = new Set();
    let revealedCount = 0;
    let balance = 10000;  //–ë–∞–ª–∞–Ω—Å
    let currentBet = 0;
    let coefficient = 1.0;
    let gameActive = false;
    let currentMineCount = 3;

    const gameBoard = document.getElementById('game-board');
    const balanceDisplay = document.getElementById('balance');
    const coefDisplay = document.getElementById('coef');
    const winDisplay = document.getElementById('current-win');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');
    let messageTimeout;

function setSkinSelectionEnabled(enabled) {
  document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = !enabled);
  document.querySelector('#controls button[onclick="startGame()"]').disabled = !enabled;
}

    function updateUI() {
    coefDisplay.textContent = `–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: ${coefficient.toFixed(2)}x`;
    winDisplay.textContent = `–¢–µ–∫—É—â–∏–π –≤—ã–∏–≥—Ä—ã—à: ${(currentBet * coefficient).toFixed(2)} üí∞`;
    balanceDisplay.textContent = `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} üí∞`;
    }

function showFullscreenAd(context = 'default') {
    if (typeof ysdk === 'undefined') return;

    // –°–∫—Ä—ã—Ç—å –±–∞–Ω–Ω–µ—Ä –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã
    ysdk.adv.hideBannerAdv().then(() => {
        ysdk.adv.showFullscreenAdv({
            callbacks: {
                onClose: (wasShown) => {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–Ω–µ—Ä —Å–Ω–æ–≤–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
                    ysdk.adv.showBannerAdv();
                    if (wasShown && context === 'after_loss') {
                        balance += 5;
                        updateUI();
                    }
                },
                onError: (error) => {
                    ysdk.adv.showBannerAdv();
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–∫–ª–∞–º—ã:', error);
                }
            }
        });
    });
}

function showBanner() {
    ysdk.adv.getBannerAdvStatus().then(({ stickyAdvIsShowing, reason }) => {
        if (!stickyAdvIsShowing && !reason) {
            ysdk.adv.showBannerAdv();
        }
    });
}

// –°–∫—Ä—ã—Ç—å –±–∞–Ω–Ω–µ—Ä
function hideBanner() {
    ysdk.adv.hideBannerAdv();
}

function startGame() {
    const betInput = document.getElementById('bet');
    const mineSelect = document.getElementById('mine-count');
    const bet = parseFloat(betInput.value.replace(',', '.')); 
    const mineCount = parseInt(mineSelect.value);

    if (isNaN(bet) || bet < 0.1 || bet > balance) { 
        showMessage("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É (–º–∏–Ω. 0.1)");
        return;
    }

    // –£–±—Ä–∞–Ω–æ –ø–µ—Ä–≤–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ balance -= bet
    currentBet = Math.round(bet * 100) / 100;
    balance = Math.round((balance - currentBet) * 100) / 100; // –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ

    gameActive = true;
    setSkinSelectionEnabled(false);
    currentMineCount = mineCount;
    bombs = new Set();
    cells = [];
    revealedCount = 0;
    gameBoard.innerHTML = '';
    coefficient = 1.0;
    hideMessage();

    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    while (bombs.size < mineCount) {
        bombs.add(Math.floor(Math.random() * totalCells));
    }

    for (let i = 0; i < totalCells; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.style.border = `2px solid ${skins.find(s => s.id === selectedSkinId).bgColor}`;
        cell.onclick = () => revealCell(i);
        cell.addEventListener('touchstart', (e) => {
            e.preventDefault();
            revealCell(i);
        }, { passive: false });
        gameBoard.appendChild(cell);
        cells.push(cell);
    }

    updateUI();
    document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = true);
    document.querySelector('#controls button[onclick="startGame()"]').disabled = true;
}
    
    function revealCell(index) {
      if (!gameActive) return;
      const cell = cells[index];
      if (cell.classList.contains('revealed')) return;

      cell.classList.add('revealed');
      cell.innerHTML = '';

      if (bombs.has(index)) {
        cell.classList.add('bomb');
        const img = document.createElement('img');
        img.src = getSelectedBombIcon();
        cell.appendChild(img);
        gameActive = false;
        currentBet = 0;
        revealAllCells();
        showMessage("üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
        document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = false);
        document.querySelector('#controls button[onclick="startGame()"]').disabled = false;
      } else {
        cell.classList.add('safe');
        const img = document.createElement('img');
        img.src = getSelectedCrystalIcon();
        cell.appendChild(img);
        revealedCount++;
        if (revealedCount === totalCells - currentMineCount) {
          const winnings = currentBet * coefficient;
          balance += winnings;
          updateUI();
          showMessage(`üèÜ –ü–æ–±–µ–¥–∞! –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –≤—Å–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –∏ –≤—ã–∏–≥—Ä–∞–ª–∏ ${winnings.toFixed(2)} üí∞!`);
          currentBet = 0;
          gameActive = false;
          revealAllCells();
        document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = false);
        document.querySelector('#controls button[onclick="startGame()"]').disabled = false;
        }
        const table = coefficientTable[currentMineCount];
        coefficient = table[Math.min(revealedCount - 1, table.length - 1)] || coefficient;
        updateUI();
      }
    }

function setSkinSelectionEnabled(enabled) {
  document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = !enabled);
  document.querySelector('#controls button[onclick="startGame()"]').disabled = !enabled;
}

    function revealAllCells() {
      cells.forEach((cell, index) => {
        if (!cell.classList.contains('revealed')) {
          cell.classList.add('revealed');
          cell.innerHTML = '';
          if (bombs.has(index)) {
            cell.classList.add('bomb');
            const img = document.createElement('img');
            img.src = getSelectedBombIcon();
            cell.appendChild(img);
          } else {
            cell.classList.add('safe');
            const img = document.createElement('img');
            img.src = getSelectedCrystalIcon();
            cell.appendChild(img);
          }
        }
      });
    }

    function collectWin() {
      if (!gameActive || currentBet === 0) return;
      const winnings = currentBet * coefficient;
      balance += winnings;
      revealAllCells();
      gameActive = false;
      showMessage(`üéâ –í—ã –∑–∞–±—Ä–∞–ª–∏ ${winnings.toFixed(2)} üí∞!`);
      currentBet = 0;
      updateUI();
document.querySelectorAll('.skin-item button').forEach(btn => btn.disabled = false);
document.querySelector('#controls button[onclick="startGame()"]').disabled = false;

    }

    function showMessage(msg) {
      clearTimeout(messageTimeout);
      messageText.textContent = msg;
      messageBox.classList.add('show');
      messageTimeout = setTimeout(() => {
        hideMessage();
      }, 5000);
    }

    function hideMessage() {
      messageBox.classList.remove('show');
      clearTimeout(messageTimeout);
    }

    function watchAd() {
       hideBanner();
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Yandex SDK
        if(typeof ysdk === 'undefined') {
            showMessage("–†–µ–∫–ª–∞–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
            return;
        }

    ysdk.adv.showRewardedVideo({
        callbacks: {
            onRewarded: () => {
                balance += 20;
                showMessage("üì∫ +20 üí∞ –∑–∞ —Ä–µ–∫–ª–∞–º—É!");
                updateUI();
            },
            onClose: () => showBanner(), // –í–µ—Ä–Ω—É—Ç—å –±–∞–Ω–Ω–µ—Ä
            onError: () => showBanner() // –í–µ—Ä–Ω—É—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
        }
    });
    }

    const skins = [
      {
        id: 'default',
        name: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π',
        price: 0,
        crystal: 'crystal.png',
        bomb: 'bomb.png',
        bought: true,
        imgWidth: 50,
        imgHeight: 50,
        bgColor: '#4a148c',
        navBgColor: '#4a148c',
        buttonBgColor: '#a855f7',
        bodyBgImage: "url('background.jpg')",
        buttonBgColor: '#a855f7',
        bombGlowStart: '#7e22ce',  // üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π
        bombGlowEnd: '#a855f7'     // üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω—ã–π
      },
      {
        id: 'green',
        name: '–ó–µ–ª—ë–Ω—ã–π',
        price: 1000,
        crystal: 'cristal-green.png',
        bomb: 'bomb-green.png',
        bought: false,
        imgWidth: 80,
        imgHeight: 50,
        bgColor: '#1b5e20',
        navBgColor: '#2e7d32',
        buttonBgColor: '#43a047',
        bodyBgImage: "url('background-green.jpg')",
        buttonBgColor: '#43a047',
        bombGlowStart: '#00c853', // üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å
        bombGlowEnd: '#64dd17'    // üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å
      },
      {
        id: 'red',
        name: '–ö—Ä–∞—Å–Ω—ã–π',
        price: 5000,
        crystal: 'cristal-red.png',
        bomb: 'bomb-red.png',
        bought: false,
        imgWidth: 80,
        imgHeight: 50,
        bgColor: '#b71c1c',
        navBgColor: '#c62828',
        buttonBgColor: '#e53935',
        bodyBgImage: "url('background-red.jpg')",
        buttonBgColor: '#e53935',
        bombGlowStart: '#d50000', // üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å
        bombGlowEnd: '#ff1744'    // üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å
      }
    ];

    let selectedSkinId = 'default';

    function renderSkins() {
      const container = document.getElementById('skins-list');
      container.innerHTML = '';
      skins.forEach(skin => {
        const item = document.createElement('div');
        item.className = 'skin-item';
        item.innerHTML = `
          <img src="${skin.crystal}" alt="${skin.name}"
            style="width: ${skin.imgWidth}px; height: ${skin.imgHeight}px; display: block; margin: 0 auto;" />
          <div><strong>${skin.name}</strong></div>
          <div>–¶–µ–Ω–∞: ${skin.price} üí∞</div>
          <button onclick="handleSkinAction('${skin.id}')">
            ${skin.bought ? (skin.id === selectedSkinId ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å') : '–ö—É–ø–∏—Ç—å'}
          </button>
        `;
        container.appendChild(item);
      });
    }

function updateBombAnimation(skin) {
  const styleSheet = document.getElementById('bomb-animation-style');
  styleSheet.innerHTML = `
    @keyframes bombFlash {
      0% { box-shadow: 0 0 8px 2px ${skin.bombGlowStart}; }
      100% { box-shadow: 0 0 20px 5px ${skin.bombGlowEnd}; }
    }
  `;
}

//applySkinDesign –ó–¥–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–∫–∏–Ω–∞

function applySkinDesign(skin) {
    updateBombAnimation(skin);
    document.documentElement.style.setProperty(
    '--cell-border-color', 
    skin.bgColor || '#673ab7'
  );

    document.documentElement.style.setProperty(
    '--hover-glow-color', 
    skin.buttonBgColor || '#a855f7' // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏–∑ —Å–∫–∏–Ω–∞
  );

  document.querySelectorAll('.cell').forEach(cell => {
    cell.style.borderColor = skin.bgColor;
  });

    document.querySelectorAll('.cell.revealed').forEach(cell => {
        const isBomb = cell.classList.contains('bomb');
        const img = cell.querySelector('img');
        if (img) {
            img.src = isBomb ? getSelectedBombIcon() : getSelectedCrystalIcon();
        }
    });

  document.body.style.backgroundImage = skin.bodyBgImage || '';
  document.querySelector('nav').style.backgroundColor = skin.navBgColor || '';
  document.querySelectorAll('#controls button, #skin-panel button').forEach(btn => {
    btn.style.backgroundColor = skin.buttonBgColor || '';
    btn.style.borderColor = skin.buttonBgColor || '';
  });
  document.querySelector('.container').style.borderColor = skin.bgColor || '';
  document.querySelector('.container').style.boxShadow = `0 0 20px ${skin.bgColor || '#a855f7'}`;
  document.getElementById('skin-panel').style.borderColor = skin.bgColor || '';
  document.getElementById('skin-panel').style.boxShadow = `0 0 15px ${skin.bgColor || '#a855f7'}`;

  document.querySelectorAll('#controls input, #controls select').forEach(el => {
    el.style.borderColor = skin.bgColor || '#673ab7';
    el.style.boxShadow = `0 0 10px ${skin.bgColor || '#a855f7'}`;
    el.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
    el.style.color = 'white';
  });

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ .skin-item
  setTimeout(() => {
    document.querySelectorAll('.skin-item').forEach(item => {
      item.style.borderColor = skin.bgColor || '#673ab7';
      item.style.boxShadow = `0 0 10px ${skin.bgColor || '#a855f7'}`;
      item.style.backgroundColor = 'rgba(255, 255, 255, 0.07)';
      item.style.color = 'white';
    });

    document.querySelectorAll('.skin-item button').forEach(btn => {
      btn.style.backgroundColor = skin.buttonBgColor || '#a855f7';
      btn.style.borderColor = skin.buttonBgColor || '#a855f7';
    });
  }, 0);

  // –û–±–Ω–æ–≤–ª—è–µ–º message-box
  const messageBox = document.getElementById('message-box');
  messageBox.style.borderColor = skin.bgColor || '#a855f7';
  messageBox.style.boxShadow = `0 0 15px ${skin.bgColor || '#a855f7'}`;
}

    function getSelectedBombIcon() {
      const skin = skins.find(s => s.id === selectedSkinId);
      return skin?.bomb || 'bomb.png';
    }

    function getSelectedCrystalIcon() {
      const skin = skins.find(s => s.id === selectedSkinId);
      return skin?.crystal || 'crystal.png';
    }

function handleSkinAction(id) {
    const skin = skins.find(s => s.id === id);
    if (!skin.bought) {
        if (balance >= skin.price) {
            balance -= skin.price;
            skin.bought = true;
            selectedSkinId = skin.id;
            applySkinDesign(skin);
            showMessage(`‚úÖ –ö—É–ø–ª–µ–Ω —Å–∫–∏–Ω "${skin.name}"`);
            updateUI();
        } else {
            showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
            return;
        }
    } else {
        selectedSkinId = skin.id;
        applySkinDesign(skin);
        
        // –î–û–ë–ê–í–õ–ï–ù–ù–´–ô –ö–û–î –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –Ø–ß–ï–ï–ö ===========
        if (gameActive) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —è—á–µ–µ–∫
            cells.forEach(cell => {
                cell.style.borderColor = skin.bgColor;
            });
        }
        // ================================================
    }
    renderSkins();
}

window.onload = () => {
  setTimeout(() => showFullscreenAd('first_load'), 3000);
  const skin = skins.find(s => s.id === selectedSkinId);
  updateBombAnimation(skin);
  if (skin) {
    document.documentElement.style.setProperty(
      '--cell-border-color', 
      skin.bgColor
    );
    applySkinDesign(skin);
  }
  renderSkins();
  updateUI();

};
  </script>
</body>
</html>